module.exports=function(e){var t={};function s(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=22)}([function(e,t){e.exports=flarum.core.compat["common/app"]},function(e,t){e.exports=flarum.core.compat["common/Model"]},function(e,t){e.exports=flarum.core.compat["common/components/Button"]},function(e,t){e.exports=flarum.core.compat["common/utils/Stream"]},function(e,t){e.exports=flarum.core.compat["common/extend"]},function(e,t){e.exports=flarum.core.compat["common/components/Modal"]},function(e,t){e.exports=flarum.core.compat["common/helpers/username"]},function(e,t){e.exports=flarum.core.compat["common/helpers/humanTime"]},function(e,t){e.exports=flarum.core.compat["common/components/UserPage"]},function(e,t){e.exports=flarum.core.compat["common/models/User"]},function(e,t){e.exports=flarum.core.compat["common/utils/withAttr"]},function(e,t){e.exports=flarum.core.compat["common/utils/computed"]},function(e,t){e.exports=flarum.core.compat["common/utils/mixin"]},function(e,t){e.exports=flarum.core.compat["common/components/SettingsPage"]},function(e,t){e.exports=flarum.core.compat["common/components/Page"]},function(e,t){e.exports=flarum.core.compat["common/Component"]},function(e,t){e.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(e,t){e.exports=flarum.core.compat["common/helpers/avatar"]},function(e,t){e.exports=flarum.core.compat["common/helpers/icon"]},function(e,t){e.exports=flarum.core.compat["common/components/HeaderSecondary"]},function(e,t){e.exports=flarum.core.compat["common/components/NotificationsDropdown"]},function(e,t){e.exports=flarum.core.compat["common/components/LinkButton"]},function(e,t,s){"use strict";s.r(t);var a=s(9),n=s.n(a),r=s(1),o=s.n(r);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var u=s(11),c=s.n(u),p=s(12),l=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(s.n(p)()(o.a,{user:o.a.hasOne("user"),status:o.a.attribute("status"),reason:o.a.attribute("reason"),createdAt:o.a.attribute("createdAt",o.a.transformDate),forNickname:o.a.attribute("forNickname"),_requestedUsername:o.a.attribute("requestedUsername"),requestedUsername:c()("_requestedUsername","forNickname","user",(function(e,t,s){return null===e&&t?s.username():e}))})),d=s(4),f=s(2),h=s.n(f),q=s(13),N=s.n(q),v=s(3),y=s.n(v),b=s(5),x=s.n(b),_=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.username=y()(this.attrs.nickname?app.session.user.displayName():app.session.user.username()),this.userRequestAttr="last"+(this.attrs.nickname?"Nickname":"Username")+"Request",this.lastRequest=app.session.user[this.userRequestAttr](),this.lastRequest&&this.username(this.lastRequest.requestedUsername()),this.success=!1,this.password=y()(""),this.translationPrefix="fof-username-request.forum."+(this.attrs.nickname?"nickname":"username")+"_modals.request"},s.className=function(){return"RequestUsernameModal Modal--small"},s.title=function(){return app.translator.trans(this.translationPrefix+".title")},s.content=function(){return this.success?m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},app.translator.trans(this.translationPrefix+".confirmation_message")),m("div",{className:"Form-group"},m(h.a,{className:"Button Button--primary Button--block",onclick:this.hide.bind(this)},app.translator.trans(this.translationPrefix+".dismiss_button"))))):m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},this.lastRequest?m("p",{className:"helpText"},app.translator.trans(this.translationPrefix+".current_request",{name:this.lastRequest.requestedUsername()})):"",m("div",{className:"Form-group"},m("input",{type:"text",name:"text",className:"FormControl",placeholder:app.session.user.username(),bidi:this.username,disabled:this.deleteLoading||this.submitLoading})),m("div",{className:"Form-group"},m("input",{type:"password",name:"password",className:"FormControl",placeholder:app.translator.trans("core.forum.change_email.confirm_password_placeholder"),bidi:this.password,disabled:this.deleteLoading||this.submitLoading})),m("div",{className:"Form-group"},h.a.component({className:"Button Button--primary Button--block",type:"submit",loading:this.submitLoading},app.translator.trans(this.translationPrefix+".submit_button"))),this.lastRequest?m("div",{className:"Form-group"},h.a.component({className:"Button Button--primary Button--block",onclick:this.deleteRequest.bind(this),loading:this.deleteLoading},app.translator.trans(this.translationPrefix+".delete_button"))):""))},s.deleteRequest=function(e){e.preventDefault(),this.deleteLoading=!0,this.lastRequest.delete(),this.successAlert=app.alerts.show({type:"success"},app.translator.trans(this.translationPrefix+".deleted")),app.session.user[this.userRequestAttr]=y()(),this.hide()},s.onsubmit=function(e){var t=this;e.preventDefault(),this.alert=null;var s=this.attrs.nickname?app.session.user.displayName():app.session.user.username();this.username()!==s?(this.submitLoading=!0,app.store.createRecord("username-requests").save({username:this.username(),forNickname:this.attrs.nickname},{meta:{password:this.password()},errorHandler:this.onerror.bind(this)}).then((function(e){app.session.user[t.userRequestAttr]=y()(e),t.success=!0,t.alertAttrs=null})).catch((function(){})).then(this.loaded.bind(this))):this.hide()},s.onerror=function(t){401===t.status&&(t.alert.content=app.translator.trans("core.forum.change_email.incorrect_password_message")),e.prototype.onerror.call(this,t)},t}(x.a),g=s(14),k=s.n(g),R=s(15),P=s.n(R),w=s(16),A=s.n(w),U=s(17),j=s.n(U),B=s(6),F=s.n(B),M=s(18),L=s.n(M),O=s(7),C=s.n(O),S=s(10),T=s.n(S),D=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.request=this.attrs.request,this.approved=y()("Rejected"),this.reason=y()(""),this.translationPrefix="fof-username-request.forum."+(this.request.forNickname()?"nickname":"username")+"_modals.action"},s.title=function(){return app.translator.trans(this.translationPrefix+".title")},s.className=function(){return"RequestActionModal Modal--medium"},s.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("h3",{className:"Notification-content"},app.translator.trans(this.translationPrefix+".name",{name:F()(this.request.user()),requestedName:this.request.requestedUsername()})),m("p",{className:"help"},app.translator.trans(this.translationPrefix+".help_text")),m("legend",null,app.translator.trans(this.translationPrefix+".decision_title")),m("div",{className:"Form-group"},m("label",{className:"checkbox"},m("input",{type:"radio",name:"approved",value:"Approved",checked:"Approved"===this.approved(),onclick:T()("value",this.approved)}),app.translator.trans(this.translationPrefix+".approval_label")),m("label",{className:"checkbox"},m("input",{type:"radio",name:"rejected",value:"Rejected",checked:"Rejected"===this.approved(),onclick:T()("value",this.approved)}),app.translator.trans(this.translationPrefix+".rejected_label"))),"Rejected"===this.approved()?m("div",{className:"Form-group"},m("legend",null,app.translator.trans(this.translationPrefix+".reason_title")),m("div",{className:"BasicsPage-reason-input"},m("textarea",{className:"FormControl",value:this.reason(),disabled:this.loading,oninput:T()("value",this.reason)}))):"",m("div",{className:"Form-group"},h.a.component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading,disabled:"Rejected"===this.approved()&&!this.reason()},app.translator.trans(this.translationPrefix+".submit_button")))))},s.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.request.save({reason:this.reason(),action:this.approved()}).then((function(){t.successAlert=app.alerts.show({type:"success"},app.translator.trans(t.translationPrefix+".success"))})),app.cache.username_requests.some((function(e,s){e.id()==t.request.id()&&app.cache.username_requests.splice(s,1)})),m.redraw(),this.hide()},t}(x.a),H=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1},s.view=function(){var e=this,t=app.cache.username_requests||[];return m("div",{className:"NotificationList RequestsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("fof-username-request.forum.pending_requests.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},t.length?t.map((function(t){var s=t.forNickname()?"nickname":"username";return m("li",null,m("a",{onclick:e.showModal.bind(e,t),className:"Notification Request"},j()(t.user()),L()("fas fa-user-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},app.translator.trans("fof-username-request.forum.pending_requests."+s+"_item_text",{name:F()(t.user())})),C()(t.createdAt()),m("div",{className:"Notification-excerpt"},app.translator.trans("fof-username-request.forum.pending_requests."+s+"_exerpt",{requestedName:t.requestedUsername()}))))})):this.loading?A.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("fof-username-request.forum.pending_requests.empty_text")))))},s.showModal=function(e){app.modal.show(D,{request:e})},t}(P.a),I=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),app.history.push("requests"),app.usernameRequests.load(),this.bodyClass="App--requests"},s.view=function(){return m("div",{className:"RequestsPage"},m(H,{state:app.usernameRequests}))},t}(k.a),G=s(0),z=s.n(G),E=s(19),J=s.n(E),K=s(20),Q=function(e){function t(){return e.apply(this,arguments)||this}i(t,e),t.initAttrs=function(t){t.label=t.label||app.translator.trans("fof-username-request.forum.pending_requests.tooltip"),t.icon=t.icon||"fas fa-user-edit",e.initAttrs.call(this,t)};var s=t.prototype;return s.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?H.component({state:app.usernameRequests}):"")},s.goToRoute=function(){m.route.set(app.route("username_requests"))},s.getUnreadCount=function(){return app.cache.username_requests?app.cache.username_requests.length:app.forum.data.relationships.username_requests.data.length},s.getNewCount=function(){return app.cache.username_requests?app.cache.username_requests.length:app.forum.data.relationships.username_requests.data.length},t}(s.n(K).a),V=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.userRequestAttr="last"+(this.attrs.nickname?"Nickname":"Username")+"Request",this.request=app.session.user[this.userRequestAttr](),this.translationPrefix="fof-username-request.forum."+(this.request.forNickname()?"nickname":"username")+"_modals.results"},s.className=function(){return"ResultsModal Modal"},s.title=function(){return app.translator.trans(this.translationPrefix+".title")},s.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},"Approved"===this.request.status()?[m("h2",null,app.translator.trans(this.translationPrefix+".approved")),m("h3",null,app.translator.trans(this.translationPrefix+".new_name",{name:app.session.user.displayName()}))]:[m("h2",null,app.translator.trans(this.translationPrefix+".rejected")),m("h3",null,app.translator.trans(this.translationPrefix+".reason",{reason:this.request.reason(),i:m("i",null)})),m("p",{className:"helpText"},app.translator.trans(this.translationPrefix+".resubmit"))],m("div",{className:"Form-group"},m(h.a,{className:"Button Button--primary Button--block",onclick:this.hide.bind(this)},app.translator.trans(this.translationPrefix+".dismiss_button")))))},s.onremove=function(){app.session.user[this.userRequestAttr]=y()(),this.request.save({delete:!0})},t}(x.a),W=s(8),X=s.n(W),Y=function(e){function t(){return e.apply(this,arguments)||this}i(t,e);var s=t.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!0,this.loadUser(m.route.param("username"))},s.content=function(){var e=this;return m("table",{className:"NotificationGrid"},this.user.usernameHistory().slice(0).reverse().map((function(t){var s=Object.keys(t)[0];return m("tr",null,m("td",null,s),m("td",null,C()(e.calculateTime(t[s]))))})))},s.show=function(e){this.user=e,m.redraw()},s.calculateTime=function(e){return new Date(0).setUTCSeconds(e)},t}(X.a),Z=s(21),$=s.n(Z),ee=function(){function e(e){this.app=e,this.loading=!1,this.cache=[]}return e.prototype.load=function(){var e=this;app.cache.username_requests||(this.loading=!0,m.redraw(),app.store.find("username-requests").then((function(e){delete e.payload,app.cache.username_requests=e.sort((function(e,t){return e.createdAt()-t.createdAt()}))})).catch((function(){})).then((function(){e.loading=!1,m.redraw()})))},e}();app.initializers.add("fof-username-request",(function(){app.store.models["username-requests"]=l,n.a.prototype.lastNicknameRequest=o.a.hasOne("lastNicknameRequest"),n.a.prototype.lastUsernameRequest=o.a.hasOne("lastUsernameRequest"),n.a.prototype.usernameHistory=o.a.attribute("usernameHistory"),app.routes.username_requests={path:"/username-requests",component:I},app.routes.username_history={path:"/u/:username/history",component:Y},app.usernameRequests=new ee(app),Object(d.extend)(N.a.prototype,"accountItems",(function(e){app.forum.attribute("canRequestUsername")&&e.add("username-request",h.a.component({className:"Button",onclick:function(){app.modal.show(_)}},app.translator.trans("fof-username-request.forum.settings.username_request_button")),8),"nickname"===app.forum.attribute("displayNameDriver")&&app.forum.attribute("canRequestNickname")&&!this.user.attribute("canEditOwnNickname")&&"flarum-nicknames"in flarum.extensions&&e.add("nickname-request",h.a.component({className:"Button",onclick:function(){app.modal.show(_,{nickname:!0})}},app.translator.trans("fof-username-request.forum.settings.nickname_request_button")),8)})),Object(d.extend)(J.a.prototype,"items",(function(e){(z.a.forum.data.relationships.username_requests&&z.a.forum.data.relationships.username_requests.data.length&&!z.a.cache.username_requests||z.a.cache.username_requests&&0!==z.a.cache.username_requests.length)&&e.add("UsernameRequests",m(Q,{state:z.a.usernameRequests}),20)})),new Promise((function(){setTimeout((function(){if(z.a.session.user){var e=z.a.session.user.lastNicknameRequest()&&"Sent"!==z.a.session.user.lastNicknameRequest().status(),t=z.a.session.user.lastUsernameRequest()&&"Sent"!==z.a.session.user.lastUsernameRequest().status();(e||t)&&z.a.modal.show(V,{nickname:e})}}),1e3)})),Object(d.extend)(X.a.prototype,"navItems",(function(e){this.user.usernameHistory()&&e.add("username-requests",$.a.component({href:z.a.route("username_history",{username:this.user.username()}),icon:"fas fa-user-edit"},z.a.translator.trans("fof-username-request.forum.user.name_history_link")))}))}))}]);
//# sourceMappingURL=forum.js.map